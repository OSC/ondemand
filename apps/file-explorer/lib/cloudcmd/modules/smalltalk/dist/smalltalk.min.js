"use strict";

!function(n) {
  function t(n) {
    function e(n, t, e, r) {
      if (!Array.isArray(r)) throw Error("buttons should be array!");
      return '<div class="page">\n                <div data-name="js-close" class="close-button"></div>\n                <header>' + n + '</header>\n                <div class="content-area">\n                    ' + t + "\n                    " + e + '\n                </div>\n                <div class="action-area">\n                    <div class="button-strip"> ' + r.map(function(n, t) {
        return "<button tabindex=" + t + ' data-name="js-' + n.toLowerCase() + '">' + n + "</button>"
      }).join("") + "\n                    </div>\n                </div>\n            </div>"
    }
    function r(n, t, r, o, u) {
      var c = document.createElement("div"),
          l = ["cancel", "close", "ok"],
          d = void 0,
          v = void 0,
          p = new Promise(function(n, t) {
          var e = u && !u.cancel,
              r = function() {};
          d = n, v = t, e && (v = r)
        }),
          m = e(n, t, r, o);
      return c.innerHTML = m, c.className = "smalltalk", document.body.appendChild(c), f(c, ["ok", "input"]).forEach(function(n) {
        return n.focus()
      }), f(c, ["input"]).forEach(function(n) {
        n.setSelectionRange(0, r.length)
      }), s("click", c, l, function(n) {
        return i(n.target, c, d, v)
      }), ["click", "contextmenu"].forEach(function(n) {
        // These click handlers cause an issue where you cannot clear the
        // selection when clicking on the text, so we just comment it out.
        //
        // return c.addEventListener(n, function() {
        //   return f(c, ["ok", "input"]).forEach(function(n) {
        //     return n.focus()
        //   })
        // })
      }), c.addEventListener("keydown", a(c, d, v)), p
    }
    function a(n, t, e) {
      return function(r) {
        var a = {
          ENTER: 13,
          ESC: 27,
          TAB: 9,
          LEFT: 37,
          UP: 38,
          RIGHT: 39,
          DOWN: 40
        },
            s = r.keyCode,
            l = r.target,
            d = ["ok", "cancel", "input"],
            p = f(n, d).map(function(n) {
            return o(n)
          });
        switch (s) {
        case a.ENTER:
          i(l, n, t, e), r.preventDefault();
          break;
        case a.ESC:
          v(), e();
          break;
        case a.TAB:
          r.shiftKey && c(n, p), c(n, p), r.preventDefault();
          break;
        default:
          var m = ["left", "right", "up", "down"].some(function(n) {
            return s === a[n.toUpperCase()]
          });
          m && u(n, p)
        }
        r.stopPropagation()
      }
    }
    function o(n) {
      return n.getAttribute("data-name").replace("js-", "")
    }
    function u(n, t) {
      var e = "",
          r = document.activeElement,
          a = o(r),
          u = /ok|cancel/.test(a),
          c = t.length - 1;
      "input" !== a && c && u && (e = "cancel" === a ? "ok" : "cancel", f(n, [e]).forEach(function(n) {
        return n.focus()
      }))
    }
    function c(n, t) {
      var e = document.activeElement,
          r = o(e),
          a = t.length - 1,
          u = t.indexOf(r);
      u === a ? u = 0 : a > u && ++u;
      var c = t[u];
      f(n, [c]).forEach(function(n) {
        return n.focus()
      })
    }
    function i(n, t, e, r) {
      var a = void 0,
          o = n.getAttribute("data-name").replace("js-", "");
      /close|cancel/.test(o) ? r() : (a = f(t, ["input"]).reduce(function(n, t) {
        return t.value
      }, null), e(a)), v()
    }
    function f(n, t) {
      var e = t.map(function(t) {
        return n.querySelector('[data-name="js-' + t + '"]')
      }).filter(function(n) {
        return n
      });
      return e
    }
    function s(n, t, e, r) {
      f(t, e).forEach(function(t) {
        return t.addEventListener(n, r)
      })
    }
    function l(n) {
      var t = document.querySelector(n);
      t.parentElement.removeChild(t)
    }
    function d(n) {
      for (var t = arguments.length, e = Array(t > 1 ? t - 1 : 0), r = 1; t > r; r++) e[r - 1] = arguments[r];
      return function() {
        return n.apply(void 0, e)
      }
    }
    if (!(this instanceof t)) return new t(n);
    var v = d(l, ".smalltalk"),
        p = ["OK"],
        m = ["OK", "Cancel"];
    this.alert = function(n, t, e) {
      return r(n, t, "", p, e)
    }, this.prompt = function(n, t, e, a) {
      var o = e || "",
          u = '<input type="text" value="' + o + '" data-name="js-input">';
      return r(n, t, u, m, a)
    }, this.confirm = function(n, t, e) {
      return r(n, t, "", m, e)
    }
  }
  "undefined" != typeof module && module.exports ? module.exports = t() : n.smalltalk = t()
}("undefined" != typeof window && window);
