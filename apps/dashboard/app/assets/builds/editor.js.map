{
  "version": 3,
  "sources": ["../../javascript/packs/editor.js"],
  "sourcesContent": ["'use strict';\n\nconst KEY_PREFIX = \"ood_editor_store_\";\n\nfunction normalizeKey(key) {\n  return `${KEY_PREFIX}${key}`;\n}\n\n// Set localStorage. Adds a key prefix to reduce overlap likelihood.\nfunction setLocalStorage(key, value) {\n  localStorage.setItem(normalizeKey(key), value);\n  return null;\n}\n\n// Get localStorage. Adds a key prefix added by setter.\nfunction getLocalStorage(key) {\n  return localStorage.getItem(normalizeKey(key));\n}\n\n// Set a user preference key to a specific value.\nfunction setUserPreference(key, value) {\n  return setLocalStorage(normalizeKey(key), value);\n}\n\n// Get the current value of the key from preferences.\nfunction getUserPreference(key) {\n  return getLocalStorage(normalizeKey(key));\n}\n\njQuery(function () {\n\n  $('[data-toggle=\"tooltip\"]').tooltip();\n\n  const editorElement = document.querySelector('#editor');\n  const apiUrl = editorElement.dataset.api;\n  const filePath = editorElement.dataset.path;\n\n  // Do not load the ace editor if the element is not available\n  // ex. for directory views\n  if ($('#editor').length) {\n    $('#error').hide();\n    // Initialize the ace editor\n    const editor = ace.edit(\"editor\");\n    const loading = false;\n\n    setOptions();\n    initializeEditor();\n    setBeforeUnloadState();\n    editor.setReadOnly(false);\n\n    function initializeEditor() {\n\n      // Disables/enables the save button and binds the window popup if there are changes\n      editor.on(\"change\", function () {\n        // The dirtyCounter is an undocumented array in the UndoManager\n        // Changing the editor only modifies the dirtyCounter after the event is over,\n        // so we set it manually on change to apply the proper unload state\n        // https://github.com/ajaxorg/ace/blob/4a55188fdb0eee9e2d3854f175e67408a1e47655/lib/ace/undomanager.js#L164\n        editor.session.getUndoManager().dirtyCounter++;\n        setBeforeUnloadState();\n      });\n\n      // Mark the editor as clean after load.\n      editor.session.getUndoManager().markClean();\n\n      // Disable the save button after the initial load\n      // Modifying settings and adding data to the editor makes the UndoManager \"dirty\"\n      // so we have to explicitly re-disable it on page ready.\n      $(\"#save-button\").prop(\"disabled\", true);\n\n      // Set the caret at inside the editor on load.\n      editor.focus();\n    };\n\n    function setSaveButtonState() {\n      $(\"#save-button\").prop(\"disabled\", editor.session.getUndoManager().isClean());\n    };\n\n    function setBeforeUnloadState() {\n      if (loading) {\n        editor.session.getUndoManager().markClean();\n      };\n\n      setSaveButtonState();\n\n      window.onbeforeunload = function (e) {\n        if (!editor.session.getUndoManager().isClean()) {\n          return 'You have unsaved changes!';\n        } else {\n          // return nothing\n        };\n      };\n    };\n\n    // Toggles a spinner in place of the save icon\n    function toggleSaveSpinner() {\n      $(\"#save-icon\").toggleClass(\"glyphicon-save\");\n      $(\"#save-icon\").toggleClass(\"glyphicon-refresh\");\n      $(\"#save-icon\").toggleClass(\"glyphicon-spin\");\n    };\n\n    // Toggles a checkbox in place of the save icon\n    function toggleSaveConfirmed() {\n      $(\"#save-icon\").toggleClass(\"glyphicon-save\");\n      $(\"#save-icon\").toggleClass(\"glyphicon-saved\");\n    };\n\n    // Sets the key binding to the selected option\n    function setKeyBinding() {\n      var binding = $(\"#keybindings option:selected\").val();\n      if (binding == \"default\") {\n        binding = null;\n      }\n      editor.setKeyboardHandler(binding);\n    };\n\n    // Change the font size\n    $(\"#fontsize\").on('change', function () {\n      editor.setFontSize($(\"#fontsize option:selected\").val());\n      setUserPreference('fontsize', $(\"#fontsize option:selected\").val());\n    });\n\n    // Change the key bindings\n    $(\"#keybindings\").on('change', function () {\n      setKeyBinding();\n      setUserPreference('keybindings', $(\"#keybindings option:selected\").val());\n    });\n\n    // Change the theme\n    $(\"#theme\").on('change', function () {\n      editor.setTheme($(\"#theme option:selected\").val());\n      setUserPreference('theme', $(\"#theme option:selected\").val());\n    });\n\n    // Change the mode\n    $(\"#mode\").on('change', function () {\n      editor.getSession().setMode(\"ace/mode/\" + $(\"#mode option:selected\").val());\n      setUserPreference('mode', $(\"#mode option:selected\").val());\n    });\n\n    // Change the word wrap setting\n    $(\"#wordwrap\").on('change', function () {\n      editor.getSession().setUseWrapMode(this.checked);\n      setUserPreference('wordwrap', $(\"#wordwrap\").is(':checked'));\n    });\n\n    // Save button onclick handler\n    // sends the content to the cloudcmd api via PUT request\n    $(\"#save-button\").on('click', function () {\n      if (apiUrl !== \"\") {\n        $(\"#save-button\").prop(\"disabled\", true);\n        toggleSaveSpinner();\n        $.ajax({\n          url: apiUrl,\n          type: 'PUT',\n          data: editor.getValue(),\n          contentType: 'text/plain',\n          success: function (data) {\n            toggleSaveSpinner();\n            toggleSaveConfirmed();\n            setTimeout(function () {\n              toggleSaveConfirmed();\n            }, 2000);\n\n            editor.session.getUndoManager().markClean();\n            $(\"#save-button\").prop(\"disabled\", editor.session.getUndoManager().isClean());\n            setBeforeUnloadState();\n          },\n          error: function (request, status, error) {\n            alert(\"An error occured attempting to save this file!\\n\" + error);\n            toggleSaveSpinner();\n          }\n        });\n      } else {\n        console.log(\"Can't save this!\");\n      };\n    });\n\n    // Automatically Sets the dropdown and mode to the modelist option\n    function setModeFromModelist() {\n      var modelist = ace.require(\"ace/ext/modelist\").getModeForPath(filePath);\n      $(\"#mode\").val(modelist.name);\n      editor.session.setMode(modelist.mode);\n    };\n\n\n    function setOptions() {\n      $(\"#keybindings\").val(getUserPreference('keybindings') || \"default\");\n      setKeyBinding();\n      $(\"#fontsize\").val(getUserPreference('fontsize') || '12px');\n      editor.setFontSize($(\"#fontsize option:selected\").val());\n      $(\"#mode\").val(getUserPreference('mode') || \"text\");\n      editor.session.setMode(\"ace/mode/\" + $(\"#mode option:selected\").val());\n      $(\"#theme\").val(getUserPreference('theme') || \"ace/theme/solarized_light\");\n      editor.setTheme($(\"#theme option:selected\").val());\n      $(\"#wordwrap\").prop(\"checked\", getUserPreference('wordwrap') === \"true\");\n      editor.getSession().setUseWrapMode($(\"#wordwrap\").is(':checked'));\n    };\n\n    initializeEditor();\n  }\n});\n"],
  "mappings": ";;;AAEA,MAAM,aAAa;AAEnB,wBAAsB,KAAK;AACzB,WAAO,GAAG,aAAa;AAAA,EACzB;AAGA,2BAAyB,KAAK,OAAO;AACnC,iBAAa,QAAQ,aAAa,GAAG,GAAG,KAAK;AAC7C,WAAO;AAAA,EACT;AAGA,2BAAyB,KAAK;AAC5B,WAAO,aAAa,QAAQ,aAAa,GAAG,CAAC;AAAA,EAC/C;AAGA,6BAA2B,KAAK,OAAO;AACrC,WAAO,gBAAgB,aAAa,GAAG,GAAG,KAAK;AAAA,EACjD;AAGA,6BAA2B,KAAK;AAC9B,WAAO,gBAAgB,aAAa,GAAG,CAAC;AAAA,EAC1C;AAEA,SAAO,WAAY;AAEjB,MAAE,yBAAyB,EAAE,QAAQ;AAErC,UAAM,gBAAgB,SAAS,cAAc,SAAS;AACtD,UAAM,SAAS,cAAc,QAAQ;AACrC,UAAM,WAAW,cAAc,QAAQ;AAIvC,QAAI,EAAE,SAAS,EAAE,QAAQ;AAWvB,UAAS,mBAAT,WAA4B;AAG1B,eAAO,GAAG,UAAU,WAAY;AAK9B,iBAAO,QAAQ,eAAe,EAAE;AAChC,+BAAqB;AAAA,QACvB,CAAC;AAGD,eAAO,QAAQ,eAAe,EAAE,UAAU;AAK1C,UAAE,cAAc,EAAE,KAAK,YAAY,IAAI;AAGvC,eAAO,MAAM;AAAA,MACf,GAES,qBAAT,WAA8B;AAC5B,UAAE,cAAc,EAAE,KAAK,YAAY,OAAO,QAAQ,eAAe,EAAE,QAAQ,CAAC;AAAA,MAC9E,GAES,uBAAT,WAAgC;AAC9B,YAAI,SAAS;AACX,iBAAO,QAAQ,eAAe,EAAE,UAAU;AAAA,QAC5C;AAAC;AAED,2BAAmB;AAEnB,eAAO,iBAAiB,SAAU,GAAG;AACnC,cAAI,CAAC,OAAO,QAAQ,eAAe,EAAE,QAAQ,GAAG;AAC9C,mBAAO;AAAA,UACT,OAAO;AAAA,UAEP;AAAC;AAAA,QACH;AAAA,MACF,GAGS,oBAAT,WAA6B;AAC3B,UAAE,YAAY,EAAE,YAAY,gBAAgB;AAC5C,UAAE,YAAY,EAAE,YAAY,mBAAmB;AAC/C,UAAE,YAAY,EAAE,YAAY,gBAAgB;AAAA,MAC9C,GAGS,sBAAT,WAA+B;AAC7B,UAAE,YAAY,EAAE,YAAY,gBAAgB;AAC5C,UAAE,YAAY,EAAE,YAAY,iBAAiB;AAAA,MAC/C,GAGS,gBAAT,WAAyB;AACvB,YAAI,UAAU,EAAE,8BAA8B,EAAE,IAAI;AACpD,YAAI,WAAW,WAAW;AACxB,oBAAU;AAAA,QACZ;AACA,eAAO,mBAAmB,OAAO;AAAA,MACnC,GAiES,sBAAT,WAA+B;AAC7B,YAAI,WAAW,IAAI,QAAQ,kBAAkB,EAAE,eAAe,QAAQ;AACtE,UAAE,OAAO,EAAE,IAAI,SAAS,IAAI;AAC5B,eAAO,QAAQ,QAAQ,SAAS,IAAI;AAAA,MACtC,GAGS,aAAT,WAAsB;AACpB,UAAE,cAAc,EAAE,IAAI,kBAAkB,aAAa,KAAK,SAAS;AACnE,sBAAc;AACd,UAAE,WAAW,EAAE,IAAI,kBAAkB,UAAU,KAAK,MAAM;AAC1D,eAAO,YAAY,EAAE,2BAA2B,EAAE,IAAI,CAAC;AACvD,UAAE,OAAO,EAAE,IAAI,kBAAkB,MAAM,KAAK,MAAM;AAClD,eAAO,QAAQ,QAAQ,cAAc,EAAE,uBAAuB,EAAE,IAAI,CAAC;AACrE,UAAE,QAAQ,EAAE,IAAI,kBAAkB,OAAO,KAAK,2BAA2B;AACzE,eAAO,SAAS,EAAE,wBAAwB,EAAE,IAAI,CAAC;AACjD,UAAE,WAAW,EAAE,KAAK,WAAW,kBAAkB,UAAU,MAAM,MAAM;AACvE,eAAO,WAAW,EAAE,eAAe,EAAE,WAAW,EAAE,GAAG,UAAU,CAAC;AAAA,MAClE;AA7JA,QAAE,QAAQ,EAAE,KAAK;AAEjB,YAAM,SAAS,IAAI,KAAK,QAAQ;AAChC,YAAM,UAAU;AAEhB,iBAAW;AACX,uBAAiB;AACjB,2BAAqB;AACrB,aAAO,YAAY,KAAK;AAwBvB;AAIA;AAgBA;AAOA;AAMA;AASA;AAGD,QAAE,WAAW,EAAE,GAAG,UAAU,WAAY;AACtC,eAAO,YAAY,EAAE,2BAA2B,EAAE,IAAI,CAAC;AACvD,0BAAkB,YAAY,EAAE,2BAA2B,EAAE,IAAI,CAAC;AAAA,MACpE,CAAC;AAGD,QAAE,cAAc,EAAE,GAAG,UAAU,WAAY;AACzC,sBAAc;AACd,0BAAkB,eAAe,EAAE,8BAA8B,EAAE,IAAI,CAAC;AAAA,MAC1E,CAAC;AAGD,QAAE,QAAQ,EAAE,GAAG,UAAU,WAAY;AACnC,eAAO,SAAS,EAAE,wBAAwB,EAAE,IAAI,CAAC;AACjD,0BAAkB,SAAS,EAAE,wBAAwB,EAAE,IAAI,CAAC;AAAA,MAC9D,CAAC;AAGD,QAAE,OAAO,EAAE,GAAG,UAAU,WAAY;AAClC,eAAO,WAAW,EAAE,QAAQ,cAAc,EAAE,uBAAuB,EAAE,IAAI,CAAC;AAC1E,0BAAkB,QAAQ,EAAE,uBAAuB,EAAE,IAAI,CAAC;AAAA,MAC5D,CAAC;AAGD,QAAE,WAAW,EAAE,GAAG,UAAU,WAAY;AACtC,eAAO,WAAW,EAAE,eAAe,KAAK,OAAO;AAC/C,0BAAkB,YAAY,EAAE,WAAW,EAAE,GAAG,UAAU,CAAC;AAAA,MAC7D,CAAC;AAID,QAAE,cAAc,EAAE,GAAG,SAAS,WAAY;AACxC,YAAI,WAAW,IAAI;AACjB,YAAE,cAAc,EAAE,KAAK,YAAY,IAAI;AACvC,4BAAkB;AAClB,YAAE,KAAK;AAAA,YACL,KAAK;AAAA,YACL,MAAM;AAAA,YACN,MAAM,OAAO,SAAS;AAAA,YACtB,aAAa;AAAA,YACb,SAAS,SAAU,MAAM;AACvB,gCAAkB;AAClB,kCAAoB;AACpB,yBAAW,WAAY;AACrB,oCAAoB;AAAA,cACtB,GAAG,GAAI;AAEP,qBAAO,QAAQ,eAAe,EAAE,UAAU;AAC1C,gBAAE,cAAc,EAAE,KAAK,YAAY,OAAO,QAAQ,eAAe,EAAE,QAAQ,CAAC;AAC5E,mCAAqB;AAAA,YACvB;AAAA,YACA,OAAO,SAAU,SAAS,QAAQ,OAAO;AACvC,oBAAM,qDAAqD,KAAK;AAChE,gCAAkB;AAAA,YACpB;AAAA,UACF,CAAC;AAAA,QACH,OAAO;AACL,kBAAQ,IAAI,kBAAkB;AAAA,QAChC;AAAC;AAAA,MACH,CAAC;AAOA;AAcA;AAED,uBAAiB;AAAA,IACnB;AAAA,EACF,CAAC;",
  "names": []
}
