<%= javascript_include_tag('projects_index', nonce: true, type: 'module') %>

<div class='page-header text-center'>
  <h1>Project Manager</h1>
  <small class="text-muted">This is a preview of the new 'Project Manager'</small>
</div>

<div class="row mt-3">
  <div class="col-md-8 col-lg-9 order-2 order-md-1">
    <div class="row">
      <% @projects.each do |project| %>
        <div id="<%= project.id %>" class="project-card">
          <%= link_to(project_path(project.id), class: "text-dark project-icon #{project.mine? ? '' : 'shared'}") do %>
            <div class="text-center d-flex justify-content-center">
              <strong>
                <%= icon_tag(URI.parse(project.icon)) %>
                <%= content_tag(:div, class: 'project-title') do %>
                  <%= project.title %>
                  <small class="text-muted">
                    <%= PosixFile.username_from_cache(project.directory.stat.uid) unless project.mine? %>
                  </small>
                <% end %>
              </strong>
            </div>
            <div class="row">
              <div class="col">
		<% if project.deletable? %>
                  <%= button_to 'Delete', project_path(project.id), class: 'btn btn-danger w-100 mb-1', method: 'delete',
                        form: { class: 'button_to d-flex justify-content-center' },
                        data: { confirm: I18n.t('dashboard.jobs_project_delete_project_confirmation') }
                  %>
		<% else %>
                  <%= button_to 'Remove', project_path(project.id), class: 'btn btn-warning w-100 mb-1', method: 'delete',
                    form: { class: 'button_to d-flex justify-content-center' }
                  %>
                <% end %>
              </div>
              <% if project.editable? %>
              <div class="col">
                <%= button_to 'Edit', edit_project_path(project.id), class: 'btn btn-info w-100', method: 'get',
                    form: { class: 'd-flex justify-content-center' },
                    title: 'Edit project directory'
                %>  
              </div>
              <% end %>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>
  <div class="col-md-4 col-lg-3 order-1 order-md-2 mb-5">

      <div class="mt-5 justify-content-center text-center">
        <%= link_to(new_project_path,
              title: I18n.t('dashboard.jobs_create_blank_project'),
              class: 'text-dark btn btn-link bg-light font-weight-bold thin-outline w-100') do
        %>
          <div class="text-center d-flex align-items-center justify-content-between">
            <strong>
              <%= I18n.t('dashboard.jobs_create_blank_project') %>
            </strong>
              <%= icon_tag(URI.parse("fas://file-medical"), classes:['button-icon']) %>
          </div>
        <% end %>
      </div>

      <% if @templates.size.positive? %>
        <div class="mt-5 justify-content-center text-center">
          <%= link_to(new_project_path({template: true}),
                title: I18n.t('dashboard.jobs_create_template_project'),
                class: 'text-dark btn btn-link bg-light font-weight-bold thin-outline w-100') do
          %>
            <div class="text-center d-flex align-items-center justify-content-between">
              <strong>
                <%= I18n.t('dashboard.jobs_create_template_project') %>
              </strong>
              <%= icon_tag(URI.parse("fas://copy"), classes:['button-icon']) %>
            </div>
          <% end %>
        </div>
      <% end %>

      <div class="mt-5 justify-content-center text-center">
        <a  class="text-dark btn bg-light font-weight-bold thin-outline w-100" data-bs-toggle="collapse" data-bs-target="#load-import-pane"
          title="<%= I18n.t('dashboard.jobs_import_shared_project')%>">

          <div class="text-center d-flex align-items-center justify-content-between">
            <strong>
              <%= I18n.t('dashboard.jobs_import_shared_project') %>
            </strong>
            <%= icon_tag(URI.parse("fas://file-import"), classes:['button-icon']) %>
          </div>
        </a>
        <div id="load-import-pane" class="collapse">
          <%= render partial: 'import' %>
        </div>
      </div>

  </div>
</div>
