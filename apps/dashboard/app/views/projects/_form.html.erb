<%
  edit_project_action = action_name != "new" && action_name != "create"

  path_selector_id = "project_directory_path_selector"

  path_selector_locals = {
    path_selector_id: path_selector_id,
    show_files: false,
    show_hidden: false,
    file_pattern: '',
    initial_directory: CurrentUser.home,
    table_id: "#{path_selector_id}_table",
    breadcrumb_id: "#{path_selector_id}_breadcrumb",
    button_id: "#{path_selector_id}_button",
    input_field_id: 'project_directory',
    favorites: false,
    popup_title: 'Select Your Working Directory',
  }
%>

<div class='card'>
  <%- unless @templates.to_a.empty? -%>
    <div class='card-header'>
      <%= form.select(:template, @templates, { prompt: "--- select template ---" }, required: true, label_class: "h4")%>
    </div>
  <%- end -%>
  <div class='card-group'>
    <div class='card'>
      <div class='card-body'>
        <div class="col">
          <div class="field">
            <%= form.text_field :name, placeholder: I18n.t('dashboard.jobs_project_name_placeholder'),
                    help: I18n.t('dashboard.jobs_project_name_validation') %>
          </div>

          <div class="field">
            <%= form.text_field(:directory, placeholder: I18n.t('dashboard.jobs_project_directory_placeholder'),
                                readonly: edit_project_action,
                                required: false,
                                help: edit_project_action ? '' : I18n.t('dashboard.jobs_project_directory_help_html', root_directory: Project.dataroot.to_s).html_safe,
                                data: { 'path-selector': true })%>

            <button 
              type="button" class="btn btn-primary mt-2 <%= edit_project_action ? 'd-none' : '' %>" 
              data-bs-toggle="modal" data-bs-target="#<%= path_selector_id %>" 
            >
              <%= I18n.t('dashboard.select_path') %>
            </button>

            <%= render(partial: 'shared/path_selector_table', locals: path_selector_locals ) %>
          </div>

          <div class="field">
            <%= form.text_area :description, placeholder: I18n.t('dashboard.jobs_project_description_placeholder') %>
          </div>
          <% unless @project.private? && edit_project_action %>
            <div class="field">
              <% help_html = unless edit_project_action
                  <<-HEREDOC
                  <a type="button" href="javascript:void(0)" data-bs-toggle="popover" data-bs-placement="right" aria-title="What are groups?"
                    data-bs-content="#{I18n.t('dashboard.jobs_project_group_help')}" class="mx-1 help-button">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                      <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
                      <path d="M5.255 5.786a.237.237 0 0 0 .241.247h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286m1.557 5.763c0 .533.425.927 1.01.927.609 0 1.028-.394 1.028-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94"/>
                    </svg>
                  </a>
                  HEREDOC
                else 
                ''
                end
              %>
              <%= form.select(:group_owner,
                              CurrentUser.group_names,
                              { label: "#{I18n.t('dashboard.jobs_project_group_owner')} #{help_html}".html_safe },
                              { disabled: edit_project_action })
              %>
            </div>
	        <% end %>
        </div>
      </div>
      </div>
      <div class="card">
      <div class='card-body'>
        <div class="col">
          <div class="field">
          <%= javascript_include_tag('icon_picker', nonce: true, type: 'module') %>
          <%= form.text_field :icon, placeholder: "cog", id: "product_icon_select", value: @project.icon_class %>
            <% if @project.icon =~ /(fa[bsrl]?):\/\/(.*)/ %>
              <% icon = $2; style = $1 %>
              <p class="text-center">
                <%= fa_icon(icon, fa_style: style, id: "product_icon")  %>
              </p>
            <% else %>
              <p class="text-center">
                <%= fa_icon("cog", fa_style: "fas", id: "product_icon") %>
              </p>
            <% end %>
              <ul id="icon_picker_list">
              </ul>
          </div>
        </div>
      </div>
      </div>
    </div>
  </div>
  <br>
  <p>
    <%= form.submit 'Save', class: 'btn btn-primary', title: 'Save project' %>
    <%= form.button 'Reset', type: :reset, class: 'btn btn-default', title: 'Clear form fields' %>
    <%= link_to 'Back', projects_path, class: 'btn btn-default', title: 'Return to projects page' %>
  </p>
</div>

