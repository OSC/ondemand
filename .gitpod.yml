image:
  file: .gitpod.Dockerfile

workspaceLocation: "/ondemand"

tasks:
  - name: Bundle install
    init: >
      bundle install &&
      gp sync-done bundle

  - name: Start dev container
    init: >
      gp sync-await bundle &&
      rake dev:start
      gp sync-done dev

  - name: Enter dev container
    init: gp sync-await dev
    command: rake dev:exec
    openMode: split-left

ports:
  # Dex
  - port: 5556
    onOpen: ignore
    visibility: public

  # OnDemand
  - port: 8080
    onOpen: open-browser
    visibility: public
